-- ========== GENERATED BY QuestsDef Editor (Ctrl-Alt-Q) DO NOT EDIT MANUALLY! ==========

PlaceObj('QuestsDef', {
	Author = "Boyan",
	Chapter = "Intro",
	DisplayName = T(448008859375, --[[QuestsDef FortifyErnie DisplayName]] "Helping Ernie Village"),
	KillTCEsConditions = {
		PlaceObj('QuestIsVariableBool', {
			Condition = "or",
			QuestId = "FortifyErnie",
			Vars = set( "Completed", "Failed" ),
			__eval = function ()
				local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
				return quest.Completed or quest.Failed
			end,
		}),
	},
	NoteDefs = {
		LastNoteIdx = 27,
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					BadgeUnit = "GreasyBasil",
					Sector = "H2",
				}),
			},
			CompletionConditions = {
				PlaceObj('OR', {
					Conditions = {
						PlaceObj('QuestIsVariableBool', {
							Condition = "or",
							QuestId = "FortifyErnie",
							Vars = set( "MachineGun_Declined", "MachineGun_Done" ),
							__eval = function ()
								local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
								return quest.MachineGun_Declined or quest.MachineGun_Done
							end,
						}),
						PlaceObj('UnitSquadHasItem', {
							ItemId = "MG42",
						}),
					},
				}),
			},
			Idx = 22,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Given" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Given
					end,
				}),
			},
			Text = T(596304809902, --[[QuestsDef FortifyErnie Text]] "Basil needs a MG42 <em>machine gun</em> to protect the <em><SectorName('H2')></em>"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "H3",
				}),
			},
			HideConditions = {
				PlaceObj('OR', {
					Conditions = {
						PlaceObj('QuestIsVariableBool', {
							Condition = "or",
							QuestId = "FortifyErnie",
							Vars = set( "MachineGun_Declined", "MachineGun_Done" ),
							__eval = function ()
								local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
								return quest.MachineGun_Declined or quest.MachineGun_Done
							end,
						}),
						PlaceObj('QuestIsVariableBool', {
							QuestId = "FortifyErnie",
							Vars = set( "MachineGun_Found" ),
							__eval = function ()
								local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
								return quest.MachineGun_Found
							end,
						}),
					},
				}),
			},
			Idx = 10,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Given" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Given
					end,
				}),
			},
			Text = T(789688620753, --[[QuestsDef FortifyErnie Text]] "There is a MG42 <em>machine gun</em> in the bunker at <em><SectorName('H3')></em>"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					BadgeUnit = "GreasyBasil",
					Sector = "H2",
				}),
			},
			HideConditions = {
				PlaceObj('OR', {
					Conditions = {
						PlaceObj('QuestIsVariableBool', {
							Condition = "or",
							QuestId = "FortifyErnie",
							Vars = set( "MachineGun_Declined", "MachineGun_Done" ),
							__eval = function ()
								local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
								return quest.MachineGun_Declined or quest.MachineGun_Done
							end,
						}),
					},
				}),
				PlaceObj('OR', {
					Conditions = {
						PlaceObj('OR', {
							Conditions = {
								PlaceObj('QuestIsVariableBool', {
									Condition = "or",
									QuestId = "FortifyErnie",
									Vars = set( "MachineGun_Declined", "MachineGun_Done" ),
									__eval = function ()
										local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
										return quest.MachineGun_Declined or quest.MachineGun_Done
									end,
								}),
							},
						}),
						PlaceObj('QuestIsVariableBool', {
							QuestId = "04_Betrayal",
							Vars = set( "WorldFlipDone" ),
							__eval = function ()
								local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
								return quest.WorldFlipDone
							end,
						}),
					},
				}),
			},
			Idx = 27,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = {
						MachineGun_Found = true,
					},
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Found
					end,
				}),
			},
			Text = T(721936921108, --[[QuestsDef FortifyErnie Text]] "Found a <em>machine gun</em> such as the one requested by <em>Basil</em> from the <em><SectorName('H2')></em>"),
		}),
		PlaceObj('QuestNote', {
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Done
					end,
				}),
			},
			Idx = 19,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Done
					end,
				}),
			},
			Text = T(514400933584, --[[QuestsDef FortifyErnie Text]] "<em>Outcome:</em> Gave the MG42 <em>machine gun</em> to Basil"),
		}),
		PlaceObj('QuestNote', {
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Declined" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Declined
					end,
				}),
			},
			Idx = 20,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Declined" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Declined
					end,
				}),
			},
			Text = T(951598776794, --[[QuestsDef FortifyErnie Text]] "<em>Outcome:</em> Refused to give Basil the MG42 <em>machine gun</em>"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "H2",
				}),
			},
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "Militia_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.Militia_Done
					end,
				}),
			},
			HideConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set( "WorldFlipDone" ),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return quest.WorldFlipDone
					end,
				}),
			},
			Idx = 11,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "Militia_Given" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.Militia_Given
					end,
				}),
			},
			Text = T(300539568762, --[[QuestsDef FortifyErnie Text]] "<em>Operation</em>: Train <em>Militia</em> in the <em><SectorName('H2')></em>"),
		}),
		PlaceObj('QuestNote', {
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "Militia_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.Militia_Done
					end,
				}),
			},
			Idx = 21,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "Militia_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.Militia_Done
					end,
				}),
			},
			Text = T(777372508612, --[[QuestsDef FortifyErnie Text]] "Trained <em>Militia</em> to protect the <em><SectorName('H2')></em>"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "H2",
				}),
			},
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Done", "Militia_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Done and quest.Militia_Done
					end,
				}),
			},
			Idx = 23,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Done", "Militia_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Done and quest.Militia_Done
					end,
				}),
			},
			Text = T(972434443801, --[[QuestsDef FortifyErnie Text]] "<em>Outcome:</em> Fortified the <em><SectorName('H2')></em> with Militia and a Machine Gun\n"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "H2",
				}),
			},
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Declined", "Militia_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Declined and quest.Militia_Done
					end,
				}),
			},
			Idx = 24,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Declined", "Militia_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Declined and quest.Militia_Done
					end,
				}),
			},
			Text = T(533036635656, --[[QuestsDef FortifyErnie Text]] "<em>Outcome:</em> Fortified the <em><SectorName('H2')></em> with Militia but no Machine Gun\n"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "H3",
				}),
			},
			HideConditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "ErnieSideQuests",
					Vars = set( "RustReinforcmentsSpawn", "TCE_RustReinforcementsStop" ),
					__eval = function ()
						local quest = gv_Quests['ErnieSideQuests'] or QuestGetState('ErnieSideQuests')
						return quest.RustReinforcmentsSpawn or quest.TCE_RustReinforcementsStop
					end,
				}),
			},
			Idx = 25,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "ErnieSideQuests",
					Vars = set( "TCE_RustReinforcementsCounter" ),
					__eval = function ()
						local quest = gv_Quests['ErnieSideQuests'] or QuestGetState('ErnieSideQuests')
						return quest.TCE_RustReinforcementsCounter
					end,
				}),
			},
			Text = T(157563555346, --[[QuestsDef FortifyErnie Text]] "<em>Reinforcements</em>: It is a matter of time before someone notices that the bunker is under attack"),
		}),
		PlaceObj('QuestNote', {
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "ErnieSideQuests",
					Vars = set( "TCE_RustReinforcementsStop" ),
					__eval = function ()
						local quest = gv_Quests['ErnieSideQuests'] or QuestGetState('ErnieSideQuests')
						return quest.TCE_RustReinforcementsStop
					end,
				}),
			},
			Idx = 26,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "ErnieSideQuests",
					Vars = set( "TCE_RustReinforcementsStop" ),
					__eval = function ()
						local quest = gv_Quests['ErnieSideQuests'] or QuestGetState('ErnieSideQuests')
						return quest.TCE_RustReinforcementsStop
					end,
				}),
			},
			Text = T(519704512090, --[[QuestsDef FortifyErnie Text]] "<em>Reinforcements failed</em>: No one noticed that the <em>bunker</em> was under attack"),
		}),
	},
	Parameters = {
		["line_badge:FortifyErnie_MG"] = "DefaultQuestBadge",
		["line_badge:FortifyErnie_QuestMarker"] = "DefaultQuestBadge",
	},
	QuestGroup = "Ernie Island",
	TCEs = {
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set( "Militia_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.Militia_Done
					end,
				}),
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "FortifyErnie",
					Vars = set( "MachineGun_Declined", "MachineGun_Done" ),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Declined or quest.MachineGun_Done
					end,
				}),
			},
			Effects = {
				PlaceObj('GrantExperienceSector', {
					logImportant = true,
				}),
				PlaceObj('QuestSetVariableBool', {
					Prop = "Completed",
					QuestId = "FortifyErnie",
				}),
			},
			Once = true,
			ParamId = "TCE_CheckCompletion",
			QuestId = "FortifyErnie",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "FortifyErnie",
					Vars = set({
	Completed = false,
}),
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return not quest.Completed
					end,
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set( "WorldFlipDone" ),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return quest.WorldFlipDone
					end,
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "Failed",
					QuestId = "FortifyErnie",
				}),
			},
			Once = true,
			ParamId = "TCE_Fail",
			QuestId = "FortifyErnie",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"H3_Underground",
					},
				}),
				PlaceObj('UnitSquadHasItem', {
					ItemId = "MG42",
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "MachineGun_Found",
					QuestId = "FortifyErnie",
				}),
			},
			Once = true,
			ParamId = "TCE_MachineGunFound",
			QuestId = "FortifyErnie",
			requiredSectors = {
				"H3_Underground",
			},
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "FortifyErnie",
					Vars = {
						MachineGun_Done = true,
					},
					__eval = function ()
						local quest = gv_Quests['FortifyErnie'] or QuestGetState('FortifyErnie')
						return quest.MachineGun_Done
					end,
				}),
			},
			Effects = {
				PlaceObj('CityGrantLoyalty', {
					Amount = 10,
					City = "ErnieVillage",
					SpecialConversationMessage = T(971724501642, --[[QuestsDef FortifyErnie SpecialConversationMessage]] "provided a <em>machine gun</em>"),
				}),
				PlaceObj('SetSectorAutoResolveDefenderBonus', {
					autoResolveDefenderBonus = 500,
					sector_id = "H2",
				}),
			},
			Once = true,
			ParamId = "TCE_MachineGunCompleted",
			QuestId = "FortifyErnie",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('SectorMilitiaNumber', {
					Amount = 1,
					Condition = ">=",
					sector_id = "H2",
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "Militia_Done",
					QuestId = "FortifyErnie",
				}),
				PlaceObj('CityGrantLoyalty', {
					Amount = 15,
					City = "ErnieVillage",
					SpecialConversationMessage = T(403062598897, --[[QuestsDef FortifyErnie SpecialConversationMessage]] "trained <em>Militia</em>"),
				}),
			},
			Once = true,
			ParamId = "TCE_MilitiaCompleted",
			QuestId = "FortifyErnie",
		}),
	},
	Variables = {
		PlaceObj('QuestVarBool', {
			Name = "MentionPierre",
		}),
		PlaceObj('QuestVarBool', {
			Name = "MachineGun_Given",
		}),
		PlaceObj('QuestVarBool', {
			Name = "MachineGun_Found",
		}),
		PlaceObj('QuestVarBool', {
			Name = "MachineGun_Done",
		}),
		PlaceObj('QuestVarBool', {
			Name = "MachineGun_Declined",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Militia_Done",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Militia_Given",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Raiders_Done",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_CheckCompletion",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_MachineGunCompleted",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_MilitiaCompleted",
		}),
		PlaceObj('QuestVarBool', {
			Name = "SpawnReinforcements",
		}),
		PlaceObj('QuestVarNum', {
			Name = "LoyaltyGain_MG42",
			Value = 10,
		}),
		PlaceObj('QuestVarBool', {
			Name = "Completed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Given",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Failed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "NotStarted",
			Value = true,
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_Fail",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_MachineGunFound",
		}),
	},
	group = "Ernie",
	id = "FortifyErnie",
	param_bindings = {},
})

