-- ========== GENERATED BY QuestsDef Editor (Ctrl-Alt-Q) DO NOT EDIT MANUALLY! ==========

PlaceObj('QuestsDef', {
	Author = "Vlad",
	DevNotes = "A hidden quest for side content on Ernie after the betrayal\n\nI've intentionally moved Pierre's spawning in a TCE to allow easier tweak of conditions down the line",
	Hidden = true,
	QuestGroup = "Ernie Island",
	TCEs = {
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set( "WorldFlipDone" ),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return quest.WorldFlipDone
					end,
				}),
			},
			Effects = {
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('QuestIsVariableBool', {
							QuestId = "PierreDefeated",
							Vars = set({
	PierreDead = false,
	PierreReturn = true,
}),
							__eval = function ()
								local quest = gv_Quests['PierreDefeated'] or QuestGetState('PierreDefeated')
								return not quest.PierreDead and quest.PierreReturn
							end,
						}),
					},
					'Effects', {
						PlaceObj('QuestSetVariableBool', {
							Prop = "Pierre_SpawnErnie",
							QuestId = "ErnieSideQuests_WorldFlip",
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('CityHasLoyalty', {
							Amount = 40,
							City = "ErnieVillage",
							Condition = ">=",
						}),
					},
					'Effects', {
						PlaceObj('QuestSetVariableBool', {
							Prop = "Ernie_ExtraMilitia",
							QuestId = "ErnieSideQuests_WorldFlip",
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('CheckIsPersistentUnitDead', {
							Negate = true,
							per_ses_id = "NPC_BillyBoy",
						}),
					},
					'Effects', {
						PlaceObj('QuestSetVariableBool', {
							Prop = "BillyBoy_ErniePartisan",
							QuestId = "ErnieSideQuests_WorldFlip",
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('CheckIsPersistentUnitDead', {
							Negate = true,
							per_ses_id = "NPC_GreasyBasil",
						}),
					},
					'Effects', {
						PlaceObj('QuestSetVariableBool', {
							Prop = "Basil_ErniePartisan",
							QuestId = "ErnieSideQuests_WorldFlip",
						}),
					},
				}),
				PlaceObj('SectorEnableAutoDeploy', {
					deploy = false,
					sector_id = "H2",
				}),
			},
			Once = true,
			ParamId = "TCE_GatherPartisans",
			QuestId = "ErnieSideQuests_WorldFlip",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"H2",
					},
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set( "WorldFlipDone" ),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return quest.WorldFlipDone
					end,
				}),
				PlaceObj('UnitIsAware', {
					TargetUnit = "EnemySquad",
				}),
				PlaceObj('PlayerIsPlayerTurn', {}),
			},
			Effects = {
				PlaceObj('GroupAlert', {
					TargetUnit = "WorldFlip_Partisans",
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('QuestIsVariableBool', {
							QuestId = "ErnieSideQuests_WorldFlip",
							Vars = set( "Basil_ErniePartisan" ),
							__eval = function ()
								local quest = gv_Quests['ErnieSideQuests_WorldFlip'] or QuestGetState('ErnieSideQuests_WorldFlip')
								return quest.Basil_ErniePartisan
							end,
						}),
					},
					'Effects', {
						PlaceObj('GroupAlert', {
							TargetUnit = "GreasyBasil",
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('QuestIsVariableBool', {
							QuestId = "ErnieSideQuests_WorldFlip",
							Vars = set( "BillyBoy_ErniePartisan" ),
							__eval = function ()
								local quest = gv_Quests['ErnieSideQuests_WorldFlip'] or QuestGetState('ErnieSideQuests_WorldFlip')
								return quest.BillyBoy_ErniePartisan
							end,
						}),
					},
					'Effects', {
						PlaceObj('GroupAlert', {
							TargetUnit = "BillyBoy",
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('QuestIsVariableBool', {
							QuestId = "ErnieSideQuests_WorldFlip",
							Vars = set( "Ernie_ExtraMilitia" ),
							__eval = function ()
								local quest = gv_Quests['ErnieSideQuests_WorldFlip'] or QuestGetState('ErnieSideQuests_WorldFlip')
								return quest.Ernie_ExtraMilitia
							end,
						}),
					},
					'Effects', {
						PlaceObj('GroupAlert', {
							TargetUnit = "Militia_LoyaltyExtra",
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('QuestIsVariableBool', {
							QuestId = "ErnieSideQuests_WorldFlip",
							Vars = set( "Pierre_SpawnErnie" ),
							__eval = function ()
								local quest = gv_Quests['ErnieSideQuests_WorldFlip'] or QuestGetState('ErnieSideQuests_WorldFlip')
								return quest.Pierre_SpawnErnie
							end,
						}),
					},
					'Effects', {
						PlaceObj('GroupAlert', {
							TargetUnit = "WorldFlip_PierreAll",
						}),
					},
				}),
			},
			Once = true,
			ParamId = "TCE_PartisansJoinIn",
			QuestId = "ErnieSideQuests_WorldFlip",
			requiredSectors = {
				"H2",
			},
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set( "WorldFlipDone" ),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return quest.WorldFlipDone
					end,
				}),
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"H2",
					},
				}),
				PlaceObj('SectorIsInConflict', {
					Negate = true,
				}),
				PlaceObj('UnitIsAroundOtherUnit', {
					Distance = 15,
					SecondTargetUnit = "WorldFlip_Partisans",
					TargetUnit = "any merc",
				}),
			},
			Effects = {
				PlaceObj('PlayBanterEffect', {
					Banters = {
						"ErnieWorldFlip02_ErnieLiberated",
					},
					searchInMap = true,
					searchInMarker = false,
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('GroupIsDead', {
							Group = "GreasyBasil",
							Negate = true,
						}),
					},
					'Effects', {
						PlaceObj('GroupSetBehaviorRoam', {
							MarkerGroup = "Overheard_Civilians",
							Orient = false,
							TargetUnit = "GreasyBasil",
							UseWeapons = true,
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('GroupIsDead', {
							Group = "BillyBoy",
							Negate = true,
						}),
					},
					'Effects', {
						PlaceObj('GroupSetBehaviorRoam', {
							MarkerGroup = "Overheard_Civilians",
							Orient = false,
							TargetUnit = "BillyBoy",
							UseWeapons = true,
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('GroupIsDead', {
							Group = "Pierre",
							Negate = true,
						}),
					},
					'Effects', {
						PlaceObj('GroupSetBehaviorRoam', {
							MarkerGroup = "ErnieReturn_RoamZone",
							Orient = false,
							TargetUnit = "Pierre",
							UseWeapons = true,
						}),
					},
				}),
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('GroupIsDead', {
							Group = "WorldFlip_PierreAllies",
							Negate = true,
						}),
					},
					'Effects', {
						PlaceObj('GroupSetBehaviorRoam', {
							MarkerGroup = "ErnieReturn_RoamZone",
							Orient = false,
							TargetUnit = "WorldFlip_PierreAllies",
							UseWeapons = true,
						}),
					},
				}),
			},
			Once = true,
			ParamId = "TCE_PostErnieBanters",
			QuestId = "ErnieSideQuests_WorldFlip",
			requiredSectors = {
				"H2",
			},
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set( "WorldFlipDone" ),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return quest.WorldFlipDone
					end,
				}),
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"H2",
					},
				}),
				PlaceObj('SectorIsInConflict', {
					Negate = true,
				}),
				PlaceObj('SectorCheckOwner', {
					owner = "any enemy",
					sector_id = "H4",
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "ErnieSideQuests_WorldFlip",
					Vars = set( "Pierre_SpawnErnie" ),
					__eval = function ()
						local quest = gv_Quests['ErnieSideQuests_WorldFlip'] or QuestGetState('ErnieSideQuests_WorldFlip')
						return quest.Pierre_SpawnErnie
					end,
				}),
				PlaceObj('CheckIsPersistentUnitDead', {
					Negate = true,
					per_ses_id = "NPC_Pierre",
				}),
				PlaceObj('UnitIsAroundOtherUnit', {
					Distance = 15,
					SecondTargetUnit = "Pierre",
					TargetUnit = "any merc",
				}),
				PlaceObj('BanterHasPlayed', {
					Banters = {
						"ErnieWorldFlip02_ErnieLiberated",
					},
					WaitOver = true,
				}),
			},
			Effects = {
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('SectorCheckOwner', {
							sector_id = "H4",
						}),
					},
					'Effects', {
						PlaceObj('PlayBanterEffect', {
							Banters = {
								"ErnieWorldFlip03_ ErnieLiberated_FortTaken",
							},
							searchInMap = true,
							searchInMarker = false,
						}),
					},
					'EffectsElse', {
						PlaceObj('PlayBanterEffect', {
							Banters = {
								"ErnieWorldFlip03_ ErnieLiberated_noFort",
							},
							searchInMap = true,
							searchInMarker = false,
						}),
						PlaceObj('GroupSetBehaviorExit', {
							IdleStance = "Standing",
							MarkerGroup = "East",
							TargetUnit = "Pierre",
							UseWeapons = true,
						}),
						PlaceObj('GroupSetBehaviorExit', {
							IdleStance = "Standing",
							MarkerGroup = "East",
							TargetUnit = "WorldFlip_PierreAllies",
							UseWeapons = true,
						}),
					},
				}),
			},
			Once = true,
			ParamId = "TCE_PostErniePierre",
			QuestId = "ErnieSideQuests_WorldFlip",
			requiredSectors = {
				"H2",
			},
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"H4",
					},
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set( "WorldFlipDone" ),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return quest.WorldFlipDone
					end,
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "PierreDefeated",
					Vars = set( "PierreReturn" ),
					__eval = function ()
						local quest = gv_Quests['PierreDefeated'] or QuestGetState('PierreDefeated')
						return quest.PierreReturn
					end,
				}),
				PlaceObj('UnitIsAware', {
					DisableContextModification = true,
					Negate = true,
					TargetUnit = "PierreReturnAll",
				}),
				PlaceObj('CheckIsPersistentUnitDead', {
					Negate = true,
					per_ses_id = "NPC_Pierre",
				}),
				PlaceObj('CombatIsActive', {}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "FortAttackStarted",
					QuestId = "ErnieSideQuests_WorldFlip",
				}),
				PlaceObj('GroupAlert', {
					TargetUnit = "PierreReturnAll",
				}),
			},
			Once = true,
			ParamId = "TCE_PartisansFortress_Alert",
			QuestId = "ErnieSideQuests_WorldFlip",
			requiredSectors = {
				"H4",
			},
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('CheckIsPersistentUnitDead', {
					Negate = true,
					per_ses_id = "NPC_Pierre",
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "PierreDefeated",
					Vars = set( "PierreReturn" ),
					__eval = function ()
						local quest = gv_Quests['PierreDefeated'] or QuestGetState('PierreDefeated')
						return quest.PierreReturn
					end,
				}),
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"H4",
					},
				}),
				PlaceObj('UnitIsAroundOtherUnit', {
					Distance = 15,
					SecondTargetUnit = "Pierre",
					TargetUnit = "any merc",
				}),
				PlaceObj('BanterHasPlayed', {
					Banters = {
						"FortCorazon02_radio",
					},
					WaitOver = true,
				}),
			},
			Effects = {
				PlaceObj('PlayBanterEffect', {
					Banters = {
						"ErnieWorldFlip05_FortTaken",
					},
					searchInMap = true,
					searchInMarker = false,
				}),
				PlaceObj('GroupSetBehaviorExit', {
					IdleStance = "Standing",
					MarkerGroup = "West",
					TargetUnit = "PierreReturnAll",
					UseWeapons = true,
				}),
			},
			Once = true,
			ParamId = "TCE_PostFortressPierre",
			QuestId = "ErnieSideQuests_WorldFlip",
			requiredSectors = {
				"H4",
			},
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('GroupIsDead', {
					Group = "PierreReturnAll",
					Negate = true,
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "PierreDefeated",
					Vars = set( "PierreReturn" ),
					__eval = function ()
						local quest = gv_Quests['PierreDefeated'] or QuestGetState('PierreDefeated')
						return quest.PierreReturn
					end,
				}),
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"H4",
					},
				}),
			},
			Effects = {
				PlaceObj('GroupSetBehaviorRoam', {
					MarkerGroup = "PierreFight_Yard",
					Orient = false,
					TargetUnit = "PierreReturnAll",
					UseWeapons = true,
				}),
			},
			Once = true,
			ParamId = "TCE_PostFortressPierreRoam",
			QuestId = "ErnieSideQuests_WorldFlip",
			requiredSectors = {
				"H4",
			},
		}),
	},
	Variables = {
		PlaceObj('QuestVarBool', {
			Name = "Completed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Given",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Failed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "NotStarted",
			Value = true,
		}),
		PlaceObj('QuestVarBool', {
			Name = "Pierre_SpawnErnie",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Ernie_ExtraMilitia",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Basil_ErniePartisan",
		}),
		PlaceObj('QuestVarBool', {
			Name = "BillyBoy_ErniePartisan",
		}),
		PlaceObj('QuestVarBool', {
			Name = "FortAttackStarted",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_GatherPartisans",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_PartisansJoinIn",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_PostErnieBanters",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_PostErniePierre",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_PartisansFortress_Alert",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_PostFortressPierre",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_PostFortressPierreRoam",
		}),
	},
	group = "Ernie",
	id = "ErnieSideQuests_WorldFlip",
})

