-- ========== GENERATED BY QuestsDef Editor (Ctrl-Alt-Q) DO NOT EDIT MANUALLY! ==========

PlaceObj('QuestsDef', {
	Author = "Boyan",
	Chapter = "Intro",
	DisplayName = T(628569525444, --[[QuestsDef TakeTheFortress DisplayName]] "Fort L'Eau Bleu"),
	KillTCEsConditions = {
		PlaceObj('QuestKillTCEsOnCompleted', {}),
	},
	LineVisibleOnGive = 15,
	NoteDefs = {
		LastNoteIdx = 15,
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "H4",
				}),
			},
			HideConditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "TakeTheFortress",
					Vars = set( "Completed", "Failed" ),
					__eval = function ()
						local quest = gv_Quests['TakeTheFortress'] or QuestGetState('TakeTheFortress')
						return quest.Completed or quest.Failed
					end,
				}),
			},
			Idx = 15,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "TakeTheFortress",
					Vars = set( "Given" ),
					__eval = function ()
						local quest = gv_Quests['TakeTheFortress'] or QuestGetState('TakeTheFortress')
						return quest.Given
					end,
				}),
			},
			Text = T(156851954997, --[[QuestsDef TakeTheFortress Text]] "The <em>Legion Outpost</em> on <em>Ernie Island</em> is threatening the <em>nearby village</em>"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "H3",
				}),
				PlaceObj('QuestBadgePlacement', {
					Sector = "H4",
				}),
				PlaceObj('QuestBadgePlacement', {
					Sector = "I3",
				}),
			},
			HideConditions = {
				PlaceObj('OR', {
					Conditions = {
						PlaceObj('QuestIsVariableBool', {
							Condition = "or",
							QuestId = "TakeTheFortress",
							Vars = set( "Completed", "Failed", "FortCombatStarted" ),
							__eval = function ()
								local quest = gv_Quests['TakeTheFortress'] or QuestGetState('TakeTheFortress')
								return quest.Completed or quest.Failed or quest.FortCombatStarted
							end,
						}),
						PlaceObj('CheckExpression', {
							Expression = function (self, obj) return AllGuardpostObjectivesDone("H4") end,
						}),
					},
				}),
			},
			Idx = 6,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "ReduceFortressStrength",
					Vars = set( "FortConflict_Started", "Given_Bastien", "Given_Bunker", "Given_Deedee" ),
					__eval = function ()
						local quest = gv_Quests['ReduceFortressStrength'] or QuestGetState('ReduceFortressStrength')
						return quest.FortConflict_Started or quest.Given_Bastien or quest.Given_Bunker or quest.Given_Deedee
					end,
				}),
			},
			Text = T(115860353476, --[[QuestsDef TakeTheFortress Text]] "The defense of <em><SectorName('H4')></em> can be weakened by completing its Outpost objectives"),
		}),
		PlaceObj('QuestNote', {
			AddInHistory = true,
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "H4",
				}),
			},
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "TakeTheFortress",
					Vars = set( "Completed" ),
					__eval = function ()
						local quest = gv_Quests['TakeTheFortress'] or QuestGetState('TakeTheFortress')
						return quest.Completed
					end,
				}),
			},
			Idx = 14,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "TakeTheFortress",
					Vars = set( "Completed" ),
					__eval = function ()
						local quest = gv_Quests['TakeTheFortress'] or QuestGetState('TakeTheFortress')
						return quest.Completed
					end,
				}),
			},
			Text = T(443519195542, --[[QuestsDef TakeTheFortress Text]] "<em>Outcome:</em> Defeated <em>Pierre</em> and took control of <em><SectorName('H4')></em>"),
		}),
	},
	QuestGroup = "Ernie Island",
	TCEs = {
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('SectorCheckOwner', {
					sector_id = "H4",
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set({
	WorldFlipDone = false,
}),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return not quest.WorldFlipDone
					end,
				}),
			},
			Effects = {
				PlaceObj('GrantExperienceSector', {
					logImportant = true,
				}),
				PlaceObj('QuestSetVariableBool', {
					Prop = "Completed",
					QuestId = "TakeTheFortress",
				}),
				PlaceObj('CityGrantLoyalty', {
					Amount = 10,
					City = "ErnieVillage",
				}),
			},
			Once = true,
			ParamId = "TCE_ResolveQuest",
			QuestId = "TakeTheFortress",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "04_Betrayal",
					Vars = set( "WorldFlipDone" ),
					__eval = function ()
						local quest = gv_Quests['04_Betrayal'] or QuestGetState('04_Betrayal')
						return quest.WorldFlipDone
					end,
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "TakeTheFortress",
					Vars = set({
	Completed = false,
}),
					__eval = function ()
						local quest = gv_Quests['TakeTheFortress'] or QuestGetState('TakeTheFortress')
						return not quest.Completed
					end,
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "Failed",
					QuestId = "TakeTheFortress",
				}),
			},
			Once = true,
			ParamId = "TCE_FailQuest",
			QuestId = "TakeTheFortress",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('OR', {
					Conditions = {
						PlaceObj('CombatIsActive', {}),
						PlaceObj('QuestIsVariableBool', {
							QuestId = "PierreDefeated",
							Vars = set( "Fortress_StartFight" ),
							__eval = function ()
								local quest = gv_Quests['PierreDefeated'] or QuestGetState('PierreDefeated')
								return quest.Fortress_StartFight
							end,
						}),
					},
				}),
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"H4",
					},
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "FortCombatStarted",
					QuestId = "TakeTheFortress",
				}),
			},
			Once = true,
			ParamId = "TCE_FortStartCombat",
			QuestId = "TakeTheFortress",
			requiredSectors = {
				"H4",
			},
		}),
	},
	Variables = {
		PlaceObj('QuestVarBool', {
			Name = "PierreDead",
		}),
		PlaceObj('QuestVarBool', {
			Name = "PierreJoined",
		}),
		PlaceObj('QuestVarBool', {
			Name = "PierreSpared",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Ernie_retaken",
		}),
		PlaceObj('QuestVarBool', {
			Name = "FortCombatStarted",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_FortStartCombat",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_ResolveQuest",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_FailQuest",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Completed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Given",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Failed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "NotStarted",
			Value = true,
		}),
	},
	group = "Ernie",
	id = "TakeTheFortress",
})

