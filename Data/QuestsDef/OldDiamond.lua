-- ========== GENERATED BY QuestsDef Editor (Ctrl-Alt-Q) DO NOT EDIT MANUALLY! ==========

PlaceObj('QuestsDef', {
	DevNotes = "Prospecting activity and rewards scripted in quest Hot Diamonds (CorazonCaptureMine).",
	DisplayName = T(105813216055, --[[QuestsDef OldDiamond DisplayName]] '"Old Diamond" Mine'),
	KillTCEsConditions = {
		PlaceObj('QuestKillTCEsOnCompleted', {}),
	},
	NoteDefs = {
		LastNoteIdx = 12,
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					BadgeUnit = "LegionImpostors",
					Sector = "K10",
				}),
			},
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "OldDiamond",
					Vars = set( "FournierExposed", "ImpostorsKilled", "MentionGuns" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.FournierExposed or quest.ImpostorsKilled or quest.MentionGuns
					end,
				}),
			},
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "OldDiamond",
					Vars = set( "Given" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.Given
					end,
				}),
			},
			Text = T(326958716176, --[[QuestsDef OldDiamond Text]] "There are suspicious <em>night</em> operations at the <em><SectorName('K10')></em> mine"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					BadgeUnit = "Fournier",
					Sector = "K10",
				}),
			},
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "OldDiamond",
					Vars = set( "FournierExposed", "ImpostorsKilled" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.FournierExposed or quest.ImpostorsKilled
					end,
				}),
			},
			Idx = 2,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "OldDiamond",
					Vars = set({
	FournierExposed = false,
	MentionGuns = true,
}),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return not quest.FournierExposed and quest.MentionGuns
					end,
				}),
			},
			Text = T(870389628749, --[[QuestsDef OldDiamond Text]] "There are <em>armed men</em> pretending to be <em>night</em> shift miners at the <em><SectorName('K10')></em> mine"),
		}),
		PlaceObj('QuestNote', {
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					BadgeUnit = "LegionImpostors",
					Sector = "K10",
				}),
			},
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "OldDiamond",
					Vars = set( "ImpostorsKilled" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.ImpostorsKilled
					end,
				}),
			},
			Idx = 3,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "OldDiamond",
					Vars = set( "FournierExposed", "MentionGuns" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.FournierExposed and quest.MentionGuns
					end,
				}),
			},
			Text = T(994244792137, --[[QuestsDef OldDiamond Text]] "The <em>Legion impostors</em> at the <em><SectorName('K10')></em> mine have a secret deal with <em>Directeur Fournier</em>"),
		}),
		PlaceObj('QuestNote', {
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "OldDiamond",
					Vars = set( "FournierExposed" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.FournierExposed
					end,
				}),
			},
			Idx = 12,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "OldDiamond",
					Vars = set( "FournierExposed" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.FournierExposed
					end,
				}),
			},
			Text = T(883479239360, --[[QuestsDef OldDiamond Text]] "<em>Outcome:</em> Exposed <em>Fournier's</em> dealings with the <em>Legion</em>"),
		}),
		PlaceObj('QuestNote', {
			AddInHistory = true,
			Badges = {
				PlaceObj('QuestBadgePlacement', {
					Sector = "K10",
				}),
			},
			CompletionConditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "OldDiamond",
					Vars = set( "ImpostorsKilled" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.ImpostorsKilled
					end,
				}),
			},
			Idx = 10,
			ShowConditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "OldDiamond",
					Vars = set( "ImpostorsKilled" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.ImpostorsKilled
					end,
				}),
			},
			ShowWhenCompleted = true,
			Text = T(686850666875, --[[QuestsDef OldDiamond Text]] "<em>Outcome:</em> The <em>Legion impostors</em> at the <em><SectorName('K10')></em> mine are dead"),
		}),
		PlaceObj('QuestNote', {
			AddInHistory = true,
			CompletionConditions = {
				PlaceObj('CheckIsPersistentUnitDead', {
					per_ses_id = "NPC_Fournier",
				}),
			},
			Idx = 11,
			ShowConditions = {
				PlaceObj('CheckIsPersistentUnitDead', {
					per_ses_id = "NPC_Fournier",
				}),
			},
			Text = T(796954170187, --[[QuestsDef OldDiamond Text]] "<em>Outcome:</em> <em>Fournier</em> is dead"),
		}),
	},
	QuestGroup = "Port Cacao",
	TCEs = {
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('BanterHasPlayed', {
					Banters = {
						"OldDiamond_Fournier07",
						"OldDiamond_Fournier08",
					},
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "FournierExposed",
					QuestId = "OldDiamond",
				}),
				PlaceObj('GrantExperienceSector', {
					Amount = "XPQuestReward_Minor",
					logImportant = true,
				}),
				PlaceObj('PlayBanterEffect', {
					Banters = {
						"OldDiamond_Fournier02_ApproachExposed",
					},
					searchInMarker = false,
				}),
			},
			Once = true,
			ParamId = "TCE_ExposeManager",
			QuestId = "OldDiamond",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('PlayerIsInSectors', {
					Sectors = {
						"K10",
					},
				}),
				PlaceObj('CheckOR', {
					Conditions = {
						PlaceObj('QuestIsVariableBool', {
							QuestId = "_GroupsAttacked",
							Vars = set( "LegionImpostors" ),
							__eval = function ()
								local quest = gv_Quests['_GroupsAttacked'] or QuestGetState('_GroupsAttacked')
								return quest.LegionImpostors
							end,
						}),
						PlaceObj('BanterHasPlayed', {
							Banters = {
								"OldDiamond_Fournier02_ApproachExposed",
							},
							WaitOver = true,
						}),
					},
				}),
				PlaceObj('UnitIsOnMap', {
					TargetUnit = "LegionImpostors",
				}),
				PlaceObj('QuestIsVariableBool', {
					QuestId = "OldDiamond",
					Vars = set({
	ImpostorsKilled = false,
}),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return not quest.ImpostorsKilled
					end,
				}),
			},
			Effects = {
				PlaceObj('GroupAlert', {
					TargetUnit = "LegionImpostors",
				}),
				PlaceObj('GroupSetSide', {
					Side = "enemy1",
					TargetUnit = "LegionImpostors",
				}),
				PlaceObj('SectorEnterConflict', {
					disable_travel = true,
					sector_id = "K10",
				}),
			},
			Once = true,
			ParamId = "TCE_ImpostorsFight",
			QuestId = "OldDiamond",
			requiredSectors = {
				"K10",
			},
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('GroupIsDead', {
					Group = "LegionImpostors",
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "ImpostorsKilled",
					QuestId = "OldDiamond",
				}),
				PlaceObj('SectorEnterConflict', {
					conflict_mode = false,
					disable_travel = true,
					sector_id = "K10",
				}),
			},
			Once = true,
			ParamId = "TCE_ImpostorsKilled",
			QuestId = "OldDiamond",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "OldDiamond",
					Vars = set( "ImpostorsKilled" ),
					__eval = function ()
						local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
						return quest.ImpostorsKilled
					end,
				}),
				PlaceObj('CheckOR', {
					Conditions = {
						PlaceObj('CheckIsPersistentUnitDead', {
							per_ses_id = "NPC_Fournier",
						}),
						PlaceObj('QuestIsVariableBool', {
							QuestId = "OldDiamond",
							Vars = set( "FournierExposed" ),
							__eval = function ()
								local quest = gv_Quests['OldDiamond'] or QuestGetState('OldDiamond')
								return quest.FournierExposed
							end,
						}),
					},
				}),
			},
			Effects = {
				PlaceObj('GrantExperienceSector', {
					logImportant = true,
				}),
				PlaceObj('SectorEnterConflict', {
					conflict_mode = false,
					disable_travel = true,
					sector_id = "K10",
				}),
				PlaceObj('QuestSetVariableBool', {
					Prop = "Completed",
					QuestId = "OldDiamond",
				}),
			},
			Once = true,
			ParamId = "TCE_CompleteQuest",
			QuestId = "OldDiamond",
		}),
	},
	Variables = {
		PlaceObj('QuestVarBool', {
			Name = "Completed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Given",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Failed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "NotStarted",
			Value = true,
		}),
		PlaceObj('QuestVarBool', {
			Name = "ProspectingMention",
		}),
		PlaceObj('QuestVarBool', {
			Name = "ProspectingOpportunity",
		}),
		PlaceObj('QuestVarBool', {
			Name = "ProspectingDone",
		}),
		PlaceObj('QuestVarBool', {
			Name = "MentionGuns",
		}),
		PlaceObj('QuestVarBool', {
			Name = "FournierExposed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "ImpostorsKilled",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_ExposeManager",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_ImpostorsFight",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_ImpostorsKilled",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_CompleteQuest",
		}),
	},
	group = "PortCacao",
	id = "OldDiamond",
})

