-- ========== GENERATED BY QuestsDef Editor (Ctrl-Alt-Q) DO NOT EDIT MANUALLY! ==========

PlaceObj('QuestsDef', {
	Author = "Vlad",
	Chapter = "Act1",
	DevNotes = "Completed when the player received a radio call with an invitattion from Corazon to come to the Refugee Camp.\nAfter the situation there is resolved OR the player didn't come, the world flip happens and the player receives the 3 final quests - to defeat Corazon, Faucheux and the Major. At this point saving the President is now a side goal to defeating the Major.\n\n-- BoyanNote - I made the quest note hidden so it doesn't show up as a checkmarck completed objective.\n\nWill actually resolve as the player progresses in the game. The betrayal happens at the end of this quest.\n\nCurrently it check total territory controlled by the player. \nIf the player has control of enough mines or cities.\nIf the player is getting close to the Major.\nIf time has passed since the start of the campaign.\nIf you have completed Biff quest.\n\nAll conditions are OR\n\nSome of these conditions have a timed delay.",
	EffectOnChangeVarValue = {
		PlaceObj('QuestEffectOnStatus', {
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "Given",
					QuestId = "04_Betrayal",
				}),
				PlaceObj('CustomCodeEffect', {
					custom_code = 'ChangeAIMPremiumState("grant")',
				}),
			},
			Prop = "Completed",
		}),
	},
	Hidden = true,
	Main = true,
	NoteDefs = {
		LastNoteIdx = 3,
	},
	QuestGroup = "The Fate Of Grand Chien",
	TCEs = {
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "03_DefeatTheLegion",
					Vars = set( "StartBetrayal" ),
					__eval = function ()
						local quest = gv_Quests['03_DefeatTheLegion'] or QuestGetState('03_DefeatTheLegion')
						return quest.StartBetrayal
					end,
				}),
				PlaceObj('SatelliteGameplayRunning', {}),
			},
			Effects = {
				PlaceObj('ConditionalEffect', {
					'Conditions', {
						PlaceObj('QuestIsVariableBool', {
							Condition = "or",
							QuestId = "RescueBiff",
							Vars = set( "Completed", "Failed" ),
							__eval = function ()
								local quest = gv_Quests['RescueBiff'] or QuestGetState('RescueBiff')
								return quest.Completed or quest.Failed
							end,
						}),
					},
					'Effects', {
						PlaceObj('ConditionalEffect', {
							'Conditions', {
								PlaceObj('QuestIsVariableBool', {
									Condition = "or",
									QuestId = "RescueBiff",
									Vars = set( "BiffDeadInCombat", "BiffDeadOnArrival" ),
									__eval = function ()
										local quest = gv_Quests['RescueBiff'] or QuestGetState('RescueBiff')
										return quest.BiffDeadInCombat or quest.BiffDeadOnArrival
									end,
								}),
							},
							'Effects', {
								PlaceObj('PlayBanterEffect', {
									Banters = {
										"Radio_Biff4_Dead",
									},
									FallbackToMerc = true,
									searchInMarker = false,
								}),
								PlaceObj('QuestSetVariableBool', {
									Prop = "MERC_LegionAdonis",
									QuestId = "RescueBiff",
								}),
							},
							'EffectsElse', {
								PlaceObj('PlayBanterEffect', {
									Banters = {
										"Radio_Biff4_Saved",
									},
									FallbackToMerc = true,
									searchInMarker = false,
								}),
								PlaceObj('QuestSetVariableBool', {
									Prop = "MERC_LegionAdonis",
									QuestId = "RescueBiff",
								}),
							},
						}),
					},
					'EffectsElse', {
						PlaceObj('PlayBanterEffect', {
							Banters = {
								"Radio_BetrayalInvitation",
							},
							FallbackToMerc = true,
							searchInMarker = false,
						}),
						PlaceObj('QuestSetVariableBool', {
							Prop = "CorazonMajorBusiness",
							QuestId = "05_TakeDownMajor",
						}),
					},
				}),
				PlaceObj('QuestSetVariableBool', {
					Prop = "Completed",
					QuestId = "03_DefeatTheLegion",
				}),
			},
			Once = true,
			ParamId = "TCE_ResolveQuest",
			QuestId = "03_DefeatTheLegion",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('CheckOR', {
					Conditions = {
						PlaceObj('PlayerControlCities', {
							Amount = 12,
							CitySectors = true,
							Condition = ">=",
						}),
						PlaceObj('PlayerControlSectors', {
							Amount = 4,
							Condition = ">=",
							POIs = "Mine",
						}),
						PlaceObj('PlayerControlSectors', {
							Amount = 70,
							Condition = ">=",
						}),
					},
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableTimer', {
					Prop = "TimeToBetrayal",
					QuestId = "03_DefeatTheLegion",
					TimeAmount = 24,
					TimeAmountRangeMax = 48,
				}),
			},
			Once = true,
			ParamId = "TCE_CheckMinesORCities",
			QuestId = "03_DefeatTheLegion",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					QuestId = "03_DefeatTheLegion",
					Vars = set({
	StartBetrayal = false,
}),
					__eval = function ()
						local quest = gv_Quests['03_DefeatTheLegion'] or QuestGetState('03_DefeatTheLegion')
						return not quest.StartBetrayal
					end,
				}),
				PlaceObj('QuestHasTimerPassed', {
					QuestId = "03_DefeatTheLegion",
					TimerVariable = "TimeToBetrayal",
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "StartBetrayal",
					QuestId = "03_DefeatTheLegion",
				}),
			},
			Once = true,
			ParamId = "TCE_CheckTimeToBetray",
			QuestId = "03_DefeatTheLegion",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('CheckOR', {
					Conditions = {
						PlaceObj('SectorCheckOwner', {
							sector_id = "D14",
						}),
						PlaceObj('SectorCheckOwner', {
							sector_id = "D15",
						}),
						PlaceObj('SectorCheckOwner', {
							sector_id = "D16",
						}),
						PlaceObj('SectorCheckOwner', {
							sector_id = "C14",
						}),
						PlaceObj('SectorCheckOwner', {
							sector_id = "C15",
						}),
						PlaceObj('SectorCheckOwner', {
							sector_id = "C16",
						}),
					},
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "StartBetrayal",
					QuestId = "03_DefeatTheLegion",
				}),
			},
			Once = true,
			ParamId = "TCE_CheckCloseToMajor",
			QuestId = "03_DefeatTheLegion",
		}),
		PlaceObj('TriggeredConditionalEvent', {
			Conditions = {
				PlaceObj('QuestIsVariableBool', {
					Condition = "or",
					QuestId = "RescueBiff",
					Vars = set( "Completed" ),
					__eval = function ()
						local quest = gv_Quests['RescueBiff'] or QuestGetState('RescueBiff')
						return quest.Completed
					end,
				}),
			},
			Effects = {
				PlaceObj('QuestSetVariableBool', {
					Prop = "StartBetrayal",
					QuestId = "03_DefeatTheLegion",
				}),
			},
			Once = true,
			ParamId = "TCE_CheckBiffCompleted",
			QuestId = "03_DefeatTheLegion",
		}),
	},
	Variables = {
		PlaceObj('QuestVarBool', {
			Name = "Completed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Given",
		}),
		PlaceObj('QuestVarBool', {
			Name = "Failed",
		}),
		PlaceObj('QuestVarBool', {
			Name = "PortCacaoUnderAttack",
		}),
		PlaceObj('QuestVarBool', {
			Name = "NotStarted",
			Value = true,
		}),
		PlaceObj('QuestVarBool', {
			Name = "StartBetrayal",
		}),
		PlaceObj('QuestVarBool', {
			Name = "BetrayalTimeShortActivated",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_ResolveQuest",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_CheckMinesORCities",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_CheckCloseToMajor",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_CheckBiffCompleted",
		}),
		PlaceObj('QuestVarTCEState', {
			Name = "TCE_CheckTimeToBetray",
		}),
		PlaceObj('QuestVarNum', {
			Name = "TimeToBetrayal",
		}),
		PlaceObj('QuestVarNum', {
			Name = "SinceMinesCapturedTimer",
		}),
		PlaceObj('QuestVarBool', {
			Name = "PresidentLocation",
		}),
		PlaceObj('QuestVarBool', {
			Name = "MajorLead",
		}),
		PlaceObj('QuestVarBool', {
			Name = "MajorLocation",
		}),
		PlaceObj('QuestVarNum', {
			Name = "Taken_Sectors",
		}),
		PlaceObj('QuestVarNum', {
			Name = "Taken_Cities",
		}),
		PlaceObj('QuestVarNum', {
			Name = "Taken_Mines",
		}),
	},
	group = "Main",
	id = "03_DefeatTheLegion",
})

